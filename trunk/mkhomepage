#!/bin/sh

# clean
rm -f yacas-*.tar.gz
make clean

# Rebuild yacas and the documentation
./makemake
./configure CXXFLAGS="" CFLAGS="" --enable-server --enable-ps-doc --enable-pdf-doc
cd src ; make version.h ; cd ..
make
cd src ; make -f makefile.ibook ; cd ..
cd manmake ; make ; cd ..
sudo make install
make dist
# make distcheck

# make ps/pdf documentation
# make texdocs


# Copy all the files to a homepage directory
if [ -d homepage ] ; then : ; else  mkdir homepage ; fi; 
cd homepage

cp ../manmake/*.html .
cp ../docs/yacaslogo.gif .
tar -zcvf manual.html.tar.gz *
cp ../manmake/*.ps .
cp ../manmake/*.pdf .
tar -zcvf manual.ps.tar.gz *.ps
tar -zcvf manual.pdf.tar.gz *.pdf
rm *.ps *.pdf

cp ../docs/*.gif ../docs/*.png ../docs/*.html .
cp yacas.html index.html
yacas --patchload -pc ../docs/downloads.html.in > downloads.html

if [ -d backups ] ; then : ; else  mkdir backups ; fi; 
mv manual.html.tar.gz backups
mv manual.ps.tar.gz backups
mv manual.pdf.tar.gz backups
cd backups
mv ../../yacas-*.tar.gz .
cd ..
# chmod -R 755 *
tar -zcf ../homepage.tgz *
cd ..
rm -rf homepage/

